import { useState, useEffect } from "react";
import { motion } from "framer-motion";
import Countdown from "react-countdown";
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from "recharts";
import Web3 from "web3";

// UI components
const Card = ({ children }) => <div className="p-6 bg-gray-800 rounded-xl">{children}</div>;
const Button = ({ onClick, children }) => (
  <button onClick={onClick} className="bg-neon-blue text-gray-900 px-6 py-3 text-xl font-bold rounded-xl shadow-md hover:bg-fuchsia-500">
    {children}
  </button>
);

export default function RitaRooPresale() {
  const [tokenSales, setTokenSales] = useState(500000);
  const [presaleEndTime, setPresaleEndTime] = useState(Date.now() + 100000000);
  const [web3, setWeb3] = useState(null);
  const [account, setAccount] = useState(null);

  useEffect(() => {
    if (typeof window !== "undefined" && window.ethereum) {
      const web3Instance = new Web3(window.ethereum);
      setWeb3(web3Instance);
      window.ethereum.request({ method: "eth_requestAccounts" })
        .then(accounts => setAccount(accounts[0]))
        .catch(err => console.error("Error fetching accounts:", err));
    }
  }, []);

  const contractAddress = "0xYourTokenContractAddress";
  const contractABI = [
    {
      "constant": true,
      "inputs": [],
      "name": "totalSupply",
      "outputs": [{ "name": "", "type": "uint256" }],
      "type": "function"
    },
    {
      "constant": false,
      "inputs": [],
      "name": "buyTokens",
      "outputs": [],
      "payable": true,
      "type": "function"
    }
  ];

  const buyTokens = async () => {
    if (!web3 || !account) {
      console.error("Web3 or account not available.");
      return;
    }
    try {
      const contract = new web3.eth.Contract(contractABI, contractAddress);
      await contract.methods.buyTokens().send({ from: account, value: web3.utils.toWei("0.1", "ether") });
      setTokenSales(prevSales => prevSales + 10000);
    } catch (error) {
      console.error("Transaction Failed:", error);
    }
  };

  const salesData = [
    { name: "Launch", sales: 10000 },
    { name: "Current", sales: tokenSales }
  ];

  return (
    <div className="min-h-screen bg-gray-900 text-white flex flex-col items-center p-6">
      <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 1 }} className="text-center">
        <h1 className="text-5xl font-bold text-neon-blue drop-shadow-lg">ðŸš€ RitaRoo Presale 2.0 ðŸš€</h1>
        <p className="mt-2 text-lg text-fuchsia-500">Step into the future. Own the future.</p>
      </motion.div>
      
      <div className="mt-10 p-6 bg-gray-800 rounded-2xl shadow-xl border border-fuchsia-500 text-center">
        <h2 className="text-3xl font-semibold text-neon-blue">Presale Ends In:</h2>
        <Countdown date={presaleEndTime} className="text-4xl text-fuchsia-400 mt-2" />
      </div>
      
      <Card>
        <h2 className="text-2xl font-semibold text-fuchsia-500">Live Token Sales</h2>
        <p className="text-3xl font-bold text-neon-blue">{tokenSales.toLocaleString()} $RITAROO Sold</p>
        <ResponsiveContainer width="100%" height={200}>
          <LineChart data={salesData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="name" stroke="#fuchsia" />
            <YAxis stroke="#fuchsia" />
            <Tooltip />
            <Line type="monotone" dataKey="sales" stroke="#FF00FF" strokeWidth={2} dot={{ r: 4 }} />
          </LineChart>
        </ResponsiveContainer>
      </Card>
      
      <motion.div whileHover={{ scale: 1.1 }} whileTap={{ scale: 0.9 }}>
        <Button onClick={buyTokens}>
          Buy Tokens Now
        </Button>
      </motion.div>
    </div>
  );
}
